% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ndx_initial_glm.R
\name{ndx_initial_glm}
\alias{ndx_initial_glm}
\title{Perform an Initial GLM to Generate Residuals and Baseline Variance}
\usage{
ndx_initial_glm(Y_fmri, events, motion_params, run_idx, TR)
}
\arguments{
\item{Y_fmri}{Matrix of fMRI data (timepoints x voxels). Assumed to be
concatenated across runs if multiple runs are present.}

\item{events}{A data frame describing experimental events. Must contain columns:
- `onsets`: Numeric, onset time of the event in seconds, relative to the start of its run.
- `durations`: Numeric, duration of the event in seconds.
- `condition`: Character or factor, identifying the event type/condition.
- `blockids`: Numeric, 1-indexed, identifying the run/block each event belongs to.
              This must correspond to the runs in `run_idx` and `Y_fmri`.}

\item{motion_params}{Matrix or data frame of motion parameters (timepoints x n_regressors).
Must have the same number of rows as `Y_fmri`.}

\item{run_idx}{Numeric vector indicating run membership for each timepoint in `Y_fmri`.
(e.g., c(rep(1,100), rep(2,100)) for two runs of 100 timepoints each).}

\item{TR}{Numeric, repetition time in seconds.}
}
\value{
A list containing:
  - `Y_residuals_current`: Matrix of residuals after the full initial GLM (task + motion + polynomials).
  - `VAR_BASELINE_FOR_DES`: Numeric, variance of residuals from a task-only GLM (task + run intercepts).
}
\description{
This function performs an initial GLM fit to the fMRI data to obtain
residuals that will serve as input for subsequent denoising steps (e.g., RPCA).
It also calculates the variance of residuals from a simpler task-only model,
which is used as the denominator in the Denoising Efficacy Score (DES).
}
\examples{
\dontrun{
# Example Usage (requires fmrireg and appropriate data)
# Define some hypothetical data
n_time_per_run <- 100
n_runs <- 2
n_voxels <- 10
TR <- 2.0
total_timepoints <- n_time_per_run * n_runs

Y_fmri_example <- matrix(rnorm(total_timepoints * n_voxels), nrow = total_timepoints, ncol = n_voxels)
run_idx_example <- rep(1:n_runs, each = n_time_per_run)
motion_params_example <- matrix(rnorm(total_timepoints * 6), nrow = total_timepoints, ncol = 6)

# Simple events table
events_example <- data.frame(
  onsets = c(10, 30, 10, 30),
  durations = c(5, 5, 5, 5),
  condition = rep(c("TaskA", "TaskB"), 2),
  blockids = c(1, 1, 2, 2)
)

initial_glm_output <- ndx_initial_glm(Y_fmri_example, events_example,
                                    motion_params_example, run_idx_example, TR)
head(initial_glm_output$Y_residuals_current)
print(initial_glm_output$VAR_BASELINE_FOR_DES)
}
}
