% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ndx_spectral.R
\name{ndx_spectral_sines}
\alias{ndx_spectral_sines}
\title{Identify Sinusoidal Nuisance Regressors from a Spectrum}
\usage{
ndx_spectral_sines(
  mean_residual_for_spectrum,
  TR,
  n_sine_candidates = 6,
  nyquist_guard_factor = 0.9,
  k_tapers = 5,
  nw = 3,
  selection_criterion = "BIC",
  selection_delta_threshold = 2,
  verbose = FALSE
)
}
\arguments{
\item{mean_residual_for_spectrum}{A numeric vector representing the time series
(e.g., mean residuals across voxels) from which to estimate the spectrum.}

\item{TR}{Numeric, the repetition time of the fMRI data in seconds.}

\item{n_sine_candidates}{Integer, the maximum number of peak frequencies to
convert into sine/cosine regressors. Defaults to 6.}

\item{nyquist_guard_factor}{Numeric, a factor (0 to 1) to limit peak searching
to frequencies below this fraction of the Nyquist frequency. Helps avoid
aliasing or unstable estimates near Nyquist. Defaults to 0.9.}

\item{k_tapers}{Integer, the number of tapers to use in `multitaper::spec.mtm`.
Defaults to 5.}

\item{nw}{Numeric, the time-bandwidth product for `multitaper::spec.mtm`.
Defaults to 3.}

\item{selection_criterion}{Character string, either "BIC" or "AIC". Default "BIC".}

\item{selection_delta_threshold}{Numeric, minimum decrease in the chosen information
criterion required to retain a candidate pair. Default 2.}

\item{verbose}{Logical, whether to print verbose diagnostic messages.}
}
\value{
A matrix with `2 * n_selected_peaks` columns and `length(mean_residual_for_spectrum)`
  rows. Each pair of columns represents sine and cosine regressors for an
  identified peak frequency. Attributes \code{"freq_hz"} and \code{"freq_rad_s"}
  store the selected peak frequencies in Hz and radians/sec. If no peaks are
  selected, a zero-column matrix with these attributes is returned. \code{NULL}
  is used only when the input is invalid or spectral estimation fails.
}
\description{
This function uses multi-taper spectral estimation to identify prominent
sinusoidal components in a residual time series (typically a mean residual).
It then generates pairs of sine and cosine regressors at the frequencies
of the identified spectral peaks.
}
\examples{
\dontrun{
  set.seed(42)
  TR_val <- 2.0
  n_timepoints <- 200
  time_points <- seq(0, (n_timepoints - 1) * TR_val, by = TR_val)

  # Create a synthetic residual with a 0.05 Hz sine wave + noise
  freq_of_interest <- 0.05 # Hz
  synthetic_signal <- sin(2 * pi * freq_of_interest * time_points)
  noise <- rnorm(n_timepoints, sd = 0.5)
  mean_resid <- synthetic_signal + noise

  U_sines <- ndx_spectral_sines(mean_resid, TR = TR_val, n_sine_candidates = 3)
  if (!is.null(U_sines)) {
    print(paste("Generated", ncol(U_sines) / 2, "sine/cosine pairs."))
    print("Identified frequencies (Hz):")
    print(attr(U_sines, "freq_hz"))
    # plot(time_points, U_sines[,1], type='l', main="First Sine Regressor")
  }
}

}
