% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ndx_hrf.R
\name{prepare_hrf_response_data}
\alias{prepare_hrf_response_data}
\title{Prepare Response Data for HRF Estimation}
\usage{
prepare_hrf_response_data(
  Y_fmri,
  pass0_residuals,
  run_idx,
  validated_spike_TR_mask,
  user_options
)
}
\arguments{
\item{Y_fmri}{Validated fMRI data matrix.}

\item{pass0_residuals}{Validated Pass 0 residuals matrix.}

\item{run_idx}{Validated run index vector.}

\item{validated_spike_TR_mask}{Validated logical mask for spike TRs.}

\item{user_options}{Validated list of user options, must include 
`good_voxel_R2_threshold` and `hrf_min_good_voxels`.}
}
\value{
A list containing:
  - `ybar_clean`: Numeric vector, the robust mean of good voxels on valid TRs.
  - `block_ids_for_cv`: Numeric vector, run/block IDs for `ybar_clean`.
  - `valid_TRs_for_hrf_estimation_mask`: Logical mask for all original TRs indicating validity for HRF estimation.
  - `n_good_voxels`: Integer, count of selected good voxels.
  Returns NULL if insufficient good voxels or no valid TRs for estimation.
}
\description{
Calculates R2, selects good voxels, and prepares the robust mean time course (`ybar_clean`)
from these good voxels, along with associated masks and block IDs for cross-validation.
}
\keyword{internal}
