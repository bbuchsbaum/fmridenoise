% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ndx_design_matrix.R
\name{ndx_build_design_matrix}
\alias{ndx_build_design_matrix}
\title{Build a Full Design Matrix from Modular Components}
\usage{
ndx_build_design_matrix(
  estimated_hrfs,
  events,
  motion_params,
  rpca_components,
  spectral_sines,
  run_idx,
  TR,
  poly_degree = NULL,
  verbose = TRUE,
  drop_zero_variance = FALSE,
  zero_var_epsilon = 1e-08
)
}
\arguments{
\item{estimated_hrfs}{Tibble of HRF estimates; see old docs.}

\item{events}{Data frame of experimental events.}

\item{motion_params}{Optional matrix of motion parameters.}

\item{rpca_components}{Optional matrix of RPCA regressors.}

\item{spectral_sines}{Optional matrix of spectral sine/cosine regressors.}

\item{run_idx}{Integer vector indicating run membership for each time-point.}

\item{TR}{Positive repetition time, in seconds.}

\item{poly_degree}{Degree of Legendre polynomial baseline (per run).}

\item{verbose}{Logical flag for verbose console output.}

\item{drop_zero_variance}{Logical flag to drop near-zero variance regressors.}

\item{zero_var_epsilon}{Numeric tolerance for detecting near-zero variance
regressors. Columns with variance below this value are considered
near-constant. Default is 1e-8.}
}
\value{
Numeric matrix with one column per regressor (or `NULL` on failure).
}
\description{
This is a refactored, cleaner implementation of `ndx_build_design_matrix` that
delegates the heavy lifting to a set of small internal helper functions.  The
public interface (arguments and return value) is identical to the original
monolithic version, so existing code and tests do not need to change.
}
